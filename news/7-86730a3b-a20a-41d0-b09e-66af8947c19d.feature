Rewrite parser logic for cleanliness and consistency